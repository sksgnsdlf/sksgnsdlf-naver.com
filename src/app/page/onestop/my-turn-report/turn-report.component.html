<div class="d-flex" style="width:80rem; margin-bottom:1rem;">
    <button *ngIf="!reportData.complaint_no" class="btn btn-primary ml-auto" (click)="searchCase('');" style="margin-right:0.5rem">목록보기</button>
    <button *ngIf="reportData.complaint_no" class="btn btn-primary ml-auto" (click)="refresh();" style="margin-right:0.5rem">새로고침</button>
</div>

<!-- cont -->
<div class="card" style="width:80rem;">
    <div class="card-body row">
        <div class="hst-img-container" *ngIf="selected_hst_img">
            <div class="x_btn" (click)="selected_hst_img = ''">
                닫기 X
            </div>
            <img style="display: block;" [src]="selected_hst_img">
        </div>
        <!-- 접수 상세 -->
        <div style="padding:1rem; width: 48rem; float: left;">
            <div class="d-flex flex-row row-mb" *ngIf="reportData.receipt_dttm">
                <div class="wt8 title">접수번호</div>
                <div class="wt8">{{reportData.case_no}}</div>
                <div class="wt10 title">접수일시</div>
                <div class="wt8">{{reportData.receipt_dttm }}</div>
            </div>
            <div class="d-flex flex-row row-mb">
                <div class="wt8 title">신고자 성명</div>
                <div class="wt8">{{reportData.civil_nm}}</div>
                <div class="wt10 title">신고자 전화번호</div>
                <div class="wt8">{{reportData.civil_tel_no}}</div>
            </div>
            <div class="d-flex flex-row row-mb">
                <div class="wt8 title">접수내용</div>
                <div class="form-group" style="margin:0">
                    <textarea class="form-control" style="height:15rem;width:30rem;overflow: auto;" disabled [(ngModel)]="reportData.complaints_txt"></textarea>
                </div>
                <!--
                <button class="btn btn-primary" style="height:5rem; padding: 25px 7px;" *ngIf="!reportData.complaint_no" (click)="searchCase(selectedCate.keyword_txt,1)">사례검색</button>
                -->
            </div>
            <div class="d-flex flex-row row-mb" *ngIf="(reportData.complaint_no) && (reportData.image_url1 || reportData.image_url2 || reportData.image_url3 || reportData.image_url4)">
                <div class="wt8 title">사진정보</div>
                <div class="w445">
                    <div class="add_img_wrap">
                        <a style="width: 100px; height: 100px; overflow: hidden;">
                            <img style="width: 100%;" *ngIf="reportData.image_url1" [src]="reportData.image_url1" (click)="selectedImg = reportData.image_url1">
                        </a>
                        <a style="width: 100px; height: 100px; overflow: hidden;">
                            <img style="width: 100%;" *ngIf="reportData.image_url2" [src]="reportData.image_url2" (click)="selectedImg = reportData.image_url2">
                        </a>
                        <a style="width: 100px; height: 100px; overflow: hidden;">
                            <img style="width: 100%;" *ngIf="reportData.image_url3" [src]="reportData.image_url3" (click)="selectedImg = reportData.image_url3">
                        </a>
                        <a style="width: 100px; height: 100px; overflow: hidden;">
                            <img style="width: 100%;" *ngIf="reportData.image_url4" [src]="reportData.image_url4" (click)="selectedImg = reportData.image_url4">
                        </a>
                        <!-- <a href="#" class="add_file_btn" title="이미지 추가"></a> -->
                    </div>
                    <div class="img-container" *ngIf="selectedImg">
                        <div class="x_btn" (click)="selectedImg = ''">
                            닫기 X
                        </div>
                        <img style="display: block; margin: 10px auto; width: 100%;" [src]="selectedImg">
                    </div>
                </div>
            </div>
            <div class="d-flex flex-row row-mb">
                <div class="wt8 title">위치설명</div>
                <div>{{reportData.loc_txt}}</div>
            </div>
            <ng-container *ngIf="reportData.receipt_mthd == 1">
                <div class="d-flex flex-row row-mb">
                    <div class="title wt8">결과 수신 방법</div>
                    <div class="d-flex flex-row">
                        <div *ngFor="let item of replyMethod; let i = index" style="margin-right:0.5rem">
                            <input disabled type="radio" id="r" name="" [value]="item.id" [(ngModel)]="reportData.return_mthd">
                            <label for="r" style="margin-left:0.5rem">{{item.name}}</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex flex-row row-mb">
                    <div class="title wt8">공개여부</div>
                    <div class="d-flex flex-row">
                        <div style="margin-right:0.5rem"><input type="radio" [disabled]="reportData.complaint_no" id="p_Y" name="public" [value]="'Y'" [(ngModel)]="reportData.open_yn"><label for="p_Y" style="margin-left:0.5rem">공개</label></div>
                        <div><input type="radio" [disabled]="reportData.complaint_no" id="p_N" name="public" [value]="'N'" [(ngModel)]="reportData.open_yn"><label for="p_N" style="margin-left:0.5rem">비공개</label></div>
                    </div>
                </div>
            </ng-container>
            <ng-container>
                <div class="d-flex flex-row row-mb">
                        <div class="title wt8">처리기한</div>
                        <div class="d-flex flex-row">
                            <div *ngFor="let dueDayItem of dueDayMethod; let i = index" style="margin-right:0.5rem">
                                <!-- <input type="radio" [disabled]="reportData.complaint_no" id="dueDayMethod{{dueDayItem.id}}" name="dueDayMethod" [value]="dueDayItem.id" [(ngModel)]="''+reportData.due_day"
                                (change) = "getDueDate()"> -->
                                <label for="dueDayMethod{{dueDayItem.id}}" style="margin-left:0.5rem">{{dueDayItem.name}}일</label>
                            </div>
                        </div>

                        <div class="form-group wt14" style="margin:0">
                            <input class="form-control wt12" type="text" [(ngModel)]="reportData.due_date" disabled>
                        </div>

                    </div>
            </ng-container>
            <div class="d-flex flex-row row-mb">
                <div class="wt8 title">처리상태</div>
                <div style="padding-right: 40px;">{{reportData.proc_state_nm ? reportData.proc_state_nm : '신고접수'}}</div>
                <div class="wt4 title">분류</div>
                <div *ngIf="selectedCate.id">{{selectedCate.name}}</div>
            </div>
            <div class="d-flex row-mb" *ngIf="selectedCate.guide_txt || selectedCate.web_url">
                <div class="wt8 title">처리지침</div>
                <div style="width:35rem">
                    <ng-container *ngIf="selectedCate.guide_txt">{{selectedCate.guide_txt}}</ng-container>
                    <a *ngIf="selectedCate.web_url" [attr.href]="selectedCate.web_url" style="color: blue; text-decoration: underline;" target="_blank">링크</a>
                </div>
            </div>
        </div>
        <!-- 매뉴얼 검색 -->
        <div class="quick-menual ml-auto" style="margin-right:1rem">
            <span style="font-weight: bold">매뉴얼 검색</span>
            <div class="search_box">
                <input type="text" placeholder="검색어 입력후 엔터" style="width: 100%;" [(ngModel)]="searchTxt" (keyup.enter)="getMenual();">
                <span class="ico floatR" style="cursor: pointer" (click)="getMenual();"></span>
            </div>
            <div class="item-container">
                <div class="item" *ngFor="let item of showed_menual_list" (click)="openMenual(item);">
                &middot; {{item.subject}}
                </div>
            </div>
        </div>
        <div class="d-flex flex-column" style="padding:1rem;width:100%; padding: 1rem;">
            <div class="d-flex flex-row form-group ml-auto align-items-center">
                <span *ngIf="+reportData.proc_state >= 5" style="margin-right:1rem;">처리완료된 민원입니다.</span>
                <span *ngIf="+reportData.proc_state < 5 && !is_mine" style="margin-right:1rem;">{{is_tossed ? '이첩된' : '이첩예정'}} 민원입니다.</span>
                <button class="btn btn-primary" *ngIf="+reportData.proc_state < 5 && is_mine" style="margin-right:0.5rem" (click)="openAsgnPopup2(showAssignModal2, i, 0, q)" title="민원을 이첩합니다.">이첩</button>
                <button class="btn btn-primary" *ngIf="+reportData.proc_state < 5 && recent_asgn_state != '2' && is_mine" style="margin-right:0.5rem" (click)="newRow(1)" title="민원을 접수합니다.">내민원접수</button>
                <!--
                <button class="btn btn-primary" *ngIf="+reportData.proc_state < 5 && recent_asgn_state != '1' && is_mine" style="margin-right:0.5rem" (click)="newRow(0)" title="처리내역을 추가합니다.">처리내역추가</button>
                -->
                <button class="btn btn-primary" *ngIf="+reportData.proc_state < 5 && recent_asgn_state != '1' && is_mine" style="margin-right:0.5rem" (click)="procAddPop(procAddPopModal)" title="처리내역을 추가합니다.">처리내역추가</button>
                <button class="btn btn-primary" *ngIf="+reportData.proc_state < 5 && is_mine && recent_asgn_state == '2'" style="margin-right:0.5rem" (click)="talk_mode = 0; showAssignorPopups(4, sendModal,'민원완료처리')">민원완료처리</button>
                <button class="btn btn-primary" (click)="save();" *ngIf="+reportData.proc_state < 5 && !is_tossed">저장</button>
            </div>
            <div class="table-responsive list-table" style="overflow:unset">
                <table class="table">
                    <colgroup>
                        <col width="3%">
                        <col width="15%">
                        <col width="4%">
                        <col width="9%">
                        <col width="4%">
                        <col width="2%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>처리일시</th>
                            <th>처리내용</th>
                            <th>담당자</th>
                            <th>소속/업체</th>
                            <th>이미지</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let item of selectedUserList; let idx = index">
                            <tr *ngIf="!item.deleted" style="height: 52px;">
                                <td>{{item.proc_dttm }}</td>
                                <td style="padding: 0px;">
                                    <div class="d-flex form-group" style="margin:0">
                                        <textarea class="form-control" [disabled]="!item.isNew" style="width: calc(100% - 1px); height: 55px; resize: none; border: 1px solid lightgrey;" (change)="textareaInput($event, 'proc_txt', item)">{{item.civil_cmmt_yn=='1'?'[신고자 댓글] '+item.proc_txt : item.proc_txt}}</textarea>
                                    </div>
                                </td>
                                <td>{{item.user_nm}}</td>
                                <td>{{item.dept_nm}}</td>
                                <td>
                                    <div class="d-flex">
                                        <a style="border: 1px solid gray;" *ngIf="item.proc_hst_no && item.image_url" (click)="selected_hst_img = item.image_url;"><img [src]="item.image_url" alt="" style="width: 80%;" class="asgn_img" ></a>
                                        <a style="border: 1px solid gray;" *ngIf="item.image" (click)="selected_hst_img = item.image;"><img [src]="item.image" alt="" style="width: 80%;" class="asgn_img" ></a>
                                        <a *ngIf="!item.proc_hst_no && item.image" (click)="deleteImage(item);"><img src="assets/images/sub/delete_ico.png" alt="이미지 삭제"></a>
                                        <a *ngIf="!item.proc_hst_no && !item.image" (click)="openImage(idx);"><img src="assets/images/sub/add_person_ico.gif" alt="이미지 추가"></a>
                                        <input type="file" style="display: none" #inputFile (change)="checkFileType($event)">
                                    </div>
                                </td>
                                <td>
                                    <a *ngIf="!item.proc_hst_no" (click)="deleteRow(i);"><img src="assets/images/sub/delete_ico.png" alt="처리내역 삭제"></a>
                                </td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- 팝업 -->
<!-- 담당자 검색 -->
<ng-template #showAssignModal let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h4 class="modal-title" id="modal-basic-title">담당자 지정</h4>
        <div class="form-group" style="margin:0">
            <button type="button" class="btn btn-inverse" (click)="d('Cross click')">닫기</button>
        </div>
    </div>
    <div class="modal-body">
        <div class="card" style="margin:0">
            <div class="card-body">
                <div class="form-group d-flex">
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 0}" (click)="changePopupTab(0)">
                        인명, 업무검색
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 4}" (click)="changePopupTab(4)">
                        부서별
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 3}" (click)="changePopupTab(3)">
                        조직도
                    </div>
                    <!-- <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 1}" (click)="changePopupTab(1)">
                        협력업체
                    </div> -->
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 2}" (click)="changePopupTab(2)" *ngIf="reportData.cls_no">
                        지정담당자
                    </div>
                    <!-- <button class="btn btn-primary ml-auto" (click)="selectTempUsers()" *ngIf="assign_popup_type == 0">
                        선택
                    </button> -->
                </div>
                <div class="d-flex">
                    <ng-container *ngIf="selectedPopupTab == 0 || selectedPopupTab == 4">
                        <div class="form-group" [hidden]="!orgList || !orgList.length">
                            <select class="form-control" name="" id="" [(ngModel)]="selectedOrgId" (change)="selectedPopupTab == 0?getOrgUser():getDeptMasterUser()">
                                <option *ngIf="session.isAdmin()" value="-1">기관</option>
                                <option *ngFor="let item of orgList; let i = index" [value]="item.id">{{item.name}}</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-left:0.5rem; width:15rem;">
                            <input class="form-control" type="text" [placeholder]="selectedPopupTab == 0?'담당자 또는 업무명으로 검색':'부서명으로 검색'" style="width:14.5rem;" [(ngModel)]="q" (keyup.enter)="selectedPopupTab == 0?getOrgUser():getDeptMasterUser()" >
                        </div>
                        <div class="form-group">
                            <button class="btn btn-info" (click)="selectedPopupTab == 0?getOrgUser():getDeptMasterUser()">조회</button>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="selectedPopupTab == 1">
                        <div class="form-group" style="width:250px;">
                            <input class="form-control" type="text" placeholder="업체명, 서비스, 업무" style="width:240px;" [(ngModel)]="partner_nm" (keyup.enter)="getOrgUser()">
                        </div>
                        <div class="btn_wrap floatL marL10">
                            <button class="btn btn-info" (click)="getOrgUser()">조회</button>
                        </div>
                    </ng-container>
                </div>
                <div class="brdList_wrap marT10">
                    <!-- 인명, 업무검색 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 0 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%">
                                <col width="18%">
                                <col width="7%">
                                <col width="30%">
                                <col width="13%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>소속/업체</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of orgUserList; let i = index">
                                    <td><button class="btn btn-primary" (click)="selectTempUsers(item)">선택</button></td>
                                    <td style="text-align: left">{{item.full_dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td class="task">
                                        {{item.task_nm | slice:0:35}}{{item.task_nm && (item.task_nm).length > 35 ? '...': ''}}
                                        <div class="full">{{item.task_nm}}</div>
                                    </td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 부서별 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 4 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%" *ngIf="assign_popup_type == 0">
                                <col width="18%">
                                <col width="7%">
                                <col width="30%">
                                <col width="13%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>부서</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of deptMasterUser; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                    <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td style="text-align: left">{{item.dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td class="task">
                                    {{item.task_nm | slice:0:35}}{{item.task_nm && (item.task_nm).length > 35 ? '...': ''}}
                                    <div class="full">
                                        {{item.task_nm}}
                                    </div>
                                    </td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 조직도 -->
                    <div class="d-flex" *ngIf="selectedPopupTab == 3">
                        <div style="width:30%">
                            <div class="inner pad15">
                                <select class="form-control" [(ngModel)]="org" (change)="setOrg(org)" name="orgss" #orgss="ngModel">
                                    <option *ngFor="let item of orgs" [value]="item.id">{{item.name}}</option>
                                </select>
                                <itsm-tree-view [height]="480" [checkbox]="true" [data]="depts" (OnClick)="getDeptUser($event)"></itsm-tree-view>
                            </div>
                        </div>
                        <div style="width:70%; margin-left:1rem;">
                            <div class="table-responsive list-table" style="overflow:unset">
                                <table class="table">
                                    <colgroup>
                                        <col width="10%" *ngIf="assign_popup_type == 0">
                                        <col width="15%">
                                        <col width="10%">
                                        <col width="25%">
                                        <col width="15%">
                                        <col width="25%">
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th *ngIf="assign_popup_type == 0"></th>
                                            <th>소속</th>
                                            <th>담당자</th>
                                            <th>담당업무</th>
                                            <th>직급</th>
                                            <th>휴대전화</th>
                                        </tr>
                                    </thead>
                                    <tbody style="max-height: 480px; overflow: scroll;">
                                        <tr *ngFor="let item of userList; let i = index">
                                            <td *ngIf="assign_popup_type == 0">
                                                <input type="checkbox" (change)="userSelectChanged($event, item)">
                                            </td>
                                            <td>{{item.dept_nm}}</td>
                                            <td>{{item.user_nm}}</td>
                                            <td class="task">
                                                {{item.task_nm | slice:0:18}}{{item.task_nm && item.task_nm.length > 18 ? '...': ''}}
                                                <div class="full">
                                                {{item.task_nm}}
                                                </div>
                                            </td>
                                            <td>{{item.duty_nm}}</td>
                                            <td>{{item.cp_no}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- 협력업체 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 1 ? 'none' : ''}">
                            <colgroup>
                                <col width="4%" *ngIf="assign_popup_type == 0">
                                <col width="7%">
                                <col width="7%">
                                <col width="9%">
                                <col width="10%">
                                <col width="4%">
                                <col width="10%">
                                <col width="9%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>업체명</th>
                                    <th>소재지</th>
                                    <th>업체전화</th>
                                    <th>주요서비스</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>담당자연락처</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of partnerUserList; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                        <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td>{{item.dept_nm}}</td>
                                    <td>{{item.company_addr}}</td>
                                    <td>{{item.company_tel}}</td>
                                    <td>{{item.service_txt}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td>{{item.role_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 지정담당자 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 2 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%" *ngIf="assign_popup_type == 0">
                                <col width="18%">
                                <col width="7%">
                                <col width="25%">
                                <col width="18%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>소속/업체</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of cateUserList; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                        <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td>{{item.dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td>{{item.task_nm}}</td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<!-- 담당자 검색 -->
<ng-template #showAssignModal2 let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h4 class="modal-title" id="modal-basic-title">{{assign_popup_type == 0 ? '담당자 지정' : '직원조회'}}</h4>
        <div class="form-group" style="margin:0">
            <button type="button" class="btn btn-inverse" (click)="d('Cross click')">닫기</button>
        </div>
    </div>
    <div class="modal-body">
        <div class="card" style="margin:0">
            <div class="card-body">
                <div class="form-group d-flex">
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 4}" (click)="changePopupTab(4)">
                        부서별
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 0}" (click)="changePopupTab(0)">
                        인명, 업무검색
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 3}" (click)="changePopupTab(3)">
                        조직도
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 1}" (click)="changePopupTab(1)">
                        협력업체
                    </div>
                    <div class="btn radio-btn" [ngClass]="{'on': selectedPopupTab == 2}" (click)="changePopupTab(2)"
                        *ngIf="reportData.cls_no">
                        지정담당자
                    </div>
                    <button class="btn btn-info ml-auto" (click)="selectTempUsers2()" *ngIf="assign_popup_type == 0">
                        선택
                    </button>
                </div>
                <div class="d-flex">
                    <ng-container *ngIf="selectedPopupTab == 0 || selectedPopupTab == 4">
                        <div class="form-group" [hidden]="!orgList || !orgList.length">
                            <select class="form-control" name="" id="" [(ngModel)]="selectedOrgId" (change)="getOrgUser()">
                                <option *ngIf="session.isAdmin()" value="-1">기관</option>
                                <option *ngFor="let item of orgList; let i = index" [value]="item.id">{{item.name}}</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-left:0.5rem; width:15rem;">
                            <input class="form-control" type="text" [placeholder]="selectedPopupTab == 0?'담당자 또는 업무명으로 검색':'부서명으로 검색'" style="width:14.5rem;"
                                [(ngModel)]="q" (keyup.enter)="getOrgUser()">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-info" (click)="getOrgUser()">조회</button>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="selectedPopupTab == 1">
                        <div class="form-group" style="width:250px;">
                            <input class="form-control" type="text" placeholder="업체명, 서비스, 업무" style="width:240px;"
                                [(ngModel)]="partner_nm" (keyup.enter)="getOrgUser()">
                        </div>
                        <div class="btn_wrap floatL marL10">
                            <button class="btn btn-info" (click)="getOrgUser()">조회</button>
                        </div>
                    </ng-container>
                </div>
                <div class="brdList_wrap marT10">
                    <!-- 인명, 업무검색 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 0 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%" *ngIf="assign_popup_type == 0">
                                <col width="18%">
                                <col width="7%">
                                <col width="30%">
                                <col width="13%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>소속/업체</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of orgUserList; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                        <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td style="text-align: left">{{item.full_dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td class="task">
                                        {{item.task_nm | slice:0:35}}{{item.task_nm && (item.task_nm).length > 35 ?
                                        '...': ''}}
                                        <div class="full">
                                            {{item.task_nm}}
                                        </div>
                                    </td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 부서별 담당자 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 4 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%">
                                <col width="18%">
                                <col width="7%">
                                <col width="30%">
                                <col width="13%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>부서</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of orgDesignatedList; let i = index">
                                    <td><input type="checkbox" (change)="userSelectChanged($event, item)"></td>
                                    <td style="text-align: left">{{item.full_dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td class="task">
                                        {{item.task_nm | slice:0:35}}{{item.task_nm && (item.task_nm).length > 35 ?
                                        '...': ''}}
                                        <div class="full">{{item.task_nm}}</div>
                                    </td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 조직도 -->
                    <div class="d-flex" *ngIf="selectedPopupTab == 3">
                        <div style="width:30%">
                            <div class="inner pad15">
                                <select class="form-control" [(ngModel)]="org" (change)="setOrg(org)" name="orgss"
                                    #orgss="ngModel">
                                    <option *ngFor="let item of orgs" [value]="item.id">{{item.name}}</option>
                                </select>
                                <itsm-tree-view [height]="480" [checkbox]="true" [data]="depts" (OnClick)="getDeptUser($event)"></itsm-tree-view>
                            </div>
                        </div>
                        <div style="width:70%; margin-left:1rem;">
                            <div class="table-responsive list-table" style="overflow:unset">
                                <table class="table">
                                    <colgroup>
                                        <col width="10%" *ngIf="assign_popup_type == 0">
                                        <col width="15%">
                                        <col width="10%">
                                        <col width="25%">
                                        <col width="15%">
                                        <col width="25%">
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th *ngIf="assign_popup_type == 0"></th>
                                            <th>소속</th>
                                            <th>담당자</th>
                                            <th>담당업무</th>
                                            <th>직급</th>
                                            <th>휴대전화</th>
                                        </tr>
                                    </thead>
                                    <tbody style="max-height: 480px; overflow: scroll;">
                                        <tr *ngFor="let item of userList; let i = index">
                                            <td *ngIf="assign_popup_type == 0">
                                                <input type="checkbox" (change)="userSelectChanged($event, item)">
                                            </td>
                                            <td>{{item.dept_nm}}</td>
                                            <td>{{item.user_nm}}</td>
                                            <td class="task">
                                                {{item.task_nm | slice:0:18}}{{item.task_nm && item.task_nm.length > 18
                                                ? '...': ''}}
                                                <div class="full">
                                                    {{item.task_nm}}
                                                </div>
                                            </td>
                                            <td>{{item.duty_nm}}</td>
                                            <td>{{item.cp_no}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- 협력업체 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 1 ? 'none' : ''}">
                            <colgroup>
                                <col width="4%" *ngIf="assign_popup_type == 0">
                                <col width="7%">
                                <col width="7%">
                                <col width="9%">
                                <col width="10%">
                                <col width="6%">
                                <col width="10%">
                                <col width="9%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>업체명</th>
                                    <th>소재지</th>
                                    <th>업체전화</th>
                                    <th>주요서비스</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>담당자연락처</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of partnerUserList; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                        <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td>{{item.dept_nm}}</td>
                                    <td>{{item.company_addr}}</td>
                                    <td>{{item.company_tel}}</td>
                                    <td>{{item.service_txt}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td>{{item.role_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- 지정담당자 -->
                    <div class="table-responsive list-table" style="overflow:unset">
                        <table class="table" [ngStyle]="{'display': selectedPopupTab != 2 ? 'none' : ''}">
                            <colgroup>
                                <col width="7%" *ngIf="assign_popup_type == 0">
                                <col width="18%">
                                <col width="7%">
                                <col width="25%">
                                <col width="18%">
                                <col width="15%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th *ngIf="assign_popup_type == 0"></th>
                                    <th>소속/업체</th>
                                    <th>담당자</th>
                                    <th>담당업무</th>
                                    <th>직급</th>
                                    <th>휴대전화</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of cateUserList; let i = index">
                                    <td *ngIf="assign_popup_type == 0">
                                        <input type="checkbox" (change)="userSelectChanged($event, item)">
                                    </td>
                                    <td>{{item.dept_nm}}</td>
                                    <td>{{item.user_nm}}</td>
                                    <td>{{item.task_nm}}</td>
                                    <td>{{item.duty_nm}}</td>
                                    <td>{{item.cp_no}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<!-- 푸시/문자 전송 모달 -->
<ng-template #sendModal let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h4 class="modal-title" id="modal-basic-title">{{popupTitle}}</h4>
        <div class="form-group" style="margin:0">
            <button type="button" class="btn btn-inverse" (click)="popupText=''; d('Cross click'); send_check='0'">닫기</button>
        </div>
    </div>
    <div class="modal-body">
        <div class="card" style="margin:0">
            <div class="card-body">
              <!-- 처리중 처리완료 처리불가 -->
              <div *ngIf="talk_mode == 0" class="form-group d-flex flex-row">
                   <div class="title wt10">* 공무원 알림톡 전송</div>
                   <div>
                      <input type="radio" style="margin:0 0.5rem" id="nonsend" name="send_check" [(ngModel)]="send_check" value="0">
                      <label for="nonsend">미전송</label>
                   </div>
                   <div>
                      <input type="radio" style="margin:0 0.5rem" id="send" name="send_check" [(ngModel)]="send_check" value="1" checked>
                      <label for="send">전송</label>
                   </div>
              </div>
              <div *ngIf="talk_mode == 1 || send_check == 1">
                  <div class="form-group d-flex flex-row">
                      <div class="title wt8">*수신자:</div>
                      <input class="form-control" [disabled]="recv_type == 1" type="text" [(ngModel)]="recv_nm">
                  </div>
                  <div class="form-group d-flex flex-row" *ngIf="recv_type != 1">
                      <div class="title wt8">*전화번호:</div>
                      <input class="form-control" type="text" [(ngModel)]="recv_tel">
                  </div>
                  <!-- <div class="form-group d-flex flex-row" *ngIf="recv_type != 1">
                      <div class="title wt8">*발신자 번호:</div>
                      <input class="form-control" type="text" [(ngModel)]="recv_tel">
                  </div> -->
                  <!-- 처리중 처리완료 처리불가 -->
                  <div class="form-group d-flex flex-row" *ngIf="send_type == 0">
                      <div class="title wt8">*처리상태</div>
                      <div *ngIf="recv_type != 4" >
                          <input type="radio" style="margin:0 0.5rem" id="ing"  name="talk_var_state" [(ngModel)]="talk_var_state" value="1" checked>
                          <label for="ing">처리중</label>
                      </div>
                      <div >
                          <input *ngIf="recv_type != 4" type="radio" style="margin:0 0.5rem" id="done"  name="talk_var_state" [(ngModel)]="talk_var_state" value="2" >
                          <label for="done">처리완료</label>
                      </div>
                      <div *ngIf="recv_type != 4">
                          <input type="radio" style="margin:0 0.5rem" id="impossible"  name="talk_var_state" [(ngModel)]="talk_var_state" value="3">
                          <label for="impossible">처리불가</label>
                      </div>
                  </div>
                  <div class="form-group d-flex flex-row" let>
                      <div class="title wt8">*발송방법</div>
                      <div>
                          <input type="radio" style="margin:0 0.5rem" id="direct" name="send_mode" [(ngModel)]="send_mode" value="0" checked>
                          <label for="direct">즉시발송</label>
                      </div>
                      <div>
                          <input type="radio" style="margin:0 0.5rem" id="book" name="send_mode" [(ngModel)]="send_mode" value="1">
                          <label for="book">예약발송</label>
                      </div>
                  </div>
                  <div class="form-group d-flex flex-row">
                      <div class="title wt8">발신방법:</div>
                      {{send_type == 0? '알림톡': 'PUSH & 알림톡 (푸시와 알림톡을 함께 발송합니다)'}}
                  </div>
                  <div class="form-group">
                      <textarea class="form-control" style="height:10rem;" [(ngModel)]="popupTextValue" [disabled]="recv_type == 1">{{popupText}}</textarea>
                  </div>
                  <div class="form-group d-flex flex-row">
                      <button class="btn btn-info ml-auto" [disabled]="popupText.length == 0" (click)="recv_type >= 3 ? complete() : sendNoti(send_mode)">전송하기</button>
                  </div>
                  <div class="w625">
                      *예약발송은 익일 09시에 발송합니다.<br />
                  </div>
              </div>
              <div *ngIf="talk_mode == 0 && send_check == 0">
                  <div class="form-group d-flex flex-row" >
                      <div class="title">처리 내역을 적어주세요.</div>
                 </div>
                 <div class="form-group">
                     <textarea class="form-control" style="height:10rem;" [(ngModel)]="popupTextValue">{{popupText}}</textarea>
                 </div>
                  <div class="form-group d-flex flex-row">
                      <button class="btn btn-info ml-auto" style="margin-left:0.5rem" [disabled]="popupText.length == 0"  (click)="complete()">완료하기</button>
                  </div>
              </div>
            </div>
        </div>
    </div>
</ng-template>


<!-- 선발상태변경 -->
<ng-template #procAddPopModal let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h4 class="modal-title" id="modal-basic-title">처리내역 추가</h4>
        <div class="form-group" style="margin:0">
        <button type="button" class="btn btn-inverse" (click)="d('Cross click')">닫기</button>
        </div>
    </div>
    <div class="modal-body">
        <div class="card">
        <div class="card-body">
            <itsm-form-inflater #form (ref)="formref($event)" [options]='procAddPopModalConfig' [customBtn]='procAddPopModalBtn' [hideTitle]='true' [(value)]='body' (OnSubmitted)="procAddSubmit()"></itsm-form-inflater>
        </div>
        </div>
    </div>
</ng-template>